"use strict";exports.id=287,exports.ids=[287],exports.modules={287:(t,r,e)=>{e.r(r),e.d(r,{default:()=>c});var i=e(147),o=e.n(i),n=e(516),d=function(t,r,e,i){return new(e||(e=Promise))((function(o,n){function d(t){try{c(i.next(t))}catch(t){n(t)}}function s(t){try{c(i.throw(t))}catch(t){n(t)}}function c(t){var r;t.done?o(t.value):(r=t.value,r instanceof e?r:new e((function(t){t(r)}))).then(d,s)}c((i=i.apply(t,r||[])).next())}))};class s extends n.Z{constructor(){super("./api/DB/cart.txt"),this.writeFile=t=>d(this,void 0,void 0,(function*(){try{yield o().promises.writeFile(this.filePath,JSON.stringify(t))}catch(t){console.log("Method: writeFile, ",t)}})),this.readCartFile=()=>d(this,void 0,void 0,(function*(){try{return(yield o().promises.readFile(this.filePath,"utf8"))?JSON.parse(yield o().promises.readFile(this.filePath,"utf8")):[]}catch(t){if(-2===t.errno)try{return yield o().promises.writeFile(this.filePath,JSON.stringify([])),[]}catch(t){console.error("Method: readFile: could not create file in such directory.",t)}else console.log("Method readFile: ",t);return[]}})),this.readProductsFile=()=>d(this,void 0,void 0,(function*(){try{return(yield o().promises.readFile(this.productFilePath,"utf8"))?JSON.parse(yield o().promises.readFile(this.productFilePath,"utf8")):[]}catch(t){if(-2===t.errno)try{return yield o().promises.writeFile(this.productFilePath,JSON.stringify([])),[]}catch(t){console.error("Could not create file in such directory. ",t)}else console.log("Method readFile: ",t);return[]}})),this.createNewCart=()=>d(this,void 0,void 0,(function*(){try{const t=yield this.readCartFile(),r=(new Date).toLocaleString("es-AR");if(0===t.length||void 0===t)return yield this.writeFile([{cartId:1,timestamp:r,products:[]}]),1;{const e=Math.max(...t.map((t=>t.cartId)))+1;return yield this.writeFile([...t,{cartId:e,timestamp:r,products:[]}]),e}}catch(t){return console.error(t),t}})),this.deleteCartById=t=>d(this,void 0,void 0,(function*(){try{const r=yield this.readCartFile();if(0===r.length||void 0===r)return-1;{const e=r.filter((r=>r.cartId!==Number(t)));return e.length===r.length?-2:(yield this.writeFile(e),200)}}catch(t){return console.error(t),t}})),this.getProductsByCartId=t=>d(this,void 0,void 0,(function*(){try{const r=(yield this.readCartFile()).find((r=>r.cartId===Number(t)));if(void 0!==r){const t=r.products;return 0===t.length?new Error("Cart has no products"):t}return new Error("Cart not found")}catch(t){return console.error(t),t}})),this.addProductsById=(t,r)=>d(this,void 0,void 0,(function*(){try{const e=yield this.readCartFile(),i=e.find((r=>r.cartId===Number(t))),o=(yield this.readProductsFile()).filter((t=>{if(t.id===Number(r.id))return t}));if(0===o.length)return new Error(`Product with id: ${Number(r.id)} not found`);if(void 0!==i&&void 0!==o){const r=[...i.products,...o],n=e.map((e=>e.cartId===Number(t)?Object.assign(Object.assign({},e),{products:r}):e));return yield this.writeFile(n),o}}catch(t){return console.error(t),t}})),this.deleteProductByCartId=(t,r)=>d(this,void 0,void 0,(function*(){try{const e=yield this.readCartFile(),i=e.find((r=>r.cartId===Number(t)));if(void 0===i)return new Error(`Cart with id: ${t} not found`);{const o=i.products.filter((t=>t.id!==Number(r)));if(o.length===i.products.length)return new Error(`Product with id: ${Number(r)} not found in cart id: ${Number(t)}`);{const r=e.map((r=>r.cartId===Number(t)?Object.assign(Object.assign({},r),{products:o}):r));yield this.writeFile(r)}}}catch(t){return console.error(t),t}})),this.productFilePath="./api/DB/products.txt"}}const c=new s}};